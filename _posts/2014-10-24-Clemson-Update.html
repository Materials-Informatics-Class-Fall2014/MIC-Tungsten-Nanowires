---
layout: post
title: Clemson Project Progress Report
author: jallen30gt
date:   2014-10-25 00:30:00
tagline: Presentation Matlab results from first pre-processing and image filtering attempts
latex: true

references:
-  http://imagej.nih.gov/ij/
-  http://www.originlab.com/doc/Origin-Help/Smooth-Algorithm
-  http://www.csse.uwa.edu.au/~pk/Research/MatlabFns/Spatial/derivative7.m # A stable derivative function
-  http://www.mathworks.com/help/images/ref/medfilt2.html # Median Filter Documentation
-  http://www.mathworks.com/help/images/ref/imdilate.html
-  http://terpconnect.umd.edu/~toh/spectrum/TOC.html
-  http://awhite40.github.io/MIC-Modeling-Polymer-Composites/2014/10/15/Segmentation-via-Gaussian-Likelihood-Approximation.html
-  http://materials-informatics-lab.github.io/2014/10/14/Image-Segmentation.html
-  http://jallen30gt.github.io/MIC-Tungsten-Nanowires/2014/09/26/Interface-Analysis.html
---

# Initial Surface Analysis

Initial processing of images was conducted using [Image J](http://imagej.nih.gov/ij/), an image software package developed at
the National Institute of Health.  All images have 1024 rows of pixels and 1024 columns of pixels with each pixel representing
an area of approximately 38.9 nm by 38.9 nm.  [Line plots](http://www.icoachmath.com/math_dictionary/line_plot.html)
were created to measure the inverted gray scale signal intensities of all pixels across the entire width (all pixel columns) 
of the image and averaged across pixel 
rows 330 - 370.  As the [2-D tomography](http://en.wikipedia.org/wiki/Electron_tomography) data is a measure of the intensities of detected electrons 
through the material, it is exptected that the line plots will yield information regarding the transition zones around the 
surface of the tungsten wire sample and the evolvig tungsten-trioxide-hydrate layer.  Below is the initial line diagrams 
(using the raw data) for the sample at 0%, 50% and 100% completion through the tungsten-trioxide-hydrate growth process.

<br>

<iframe src="//www.slideshare.net/slideshow/embed_code/39731430" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<br>

As can be seen from the line plots, the data is quite noisey (and significantly so towards the edge of the images).  This is 
important as this noise becomes relevant and needs to be reduced with regards to further image processing.  


## Refining the Level of Analysis 

A [Matlab code](https://gist.github.com/jallen30gt/8254e9ea2f938363dc0b) was developed to refine the initial processing of 
images. The code was written with three simple objectives in mind:

1.  [Smooth](http://en.wikipedia.org/wiki/Smoothing) the noise in images (done with a simple [adjacent point averaging](http://www.originlab.com/doc/Origin-Help/Smooth-Algorithm) at 10 and 500 times application).
    <br>
            $$x_{avg} = \frac{x_{i+1} + x_{i-1}}{2}$$
    <br>
    <br>
2.  Find the [First Derivative](http://en.wikipedia.org/wiki/Finite_difference#Relation_with_derivatives) (numerical using centered finite-divided-difference formulas)
    <br>
            $$f^{'}(x_i)=\frac{-f(x_{i+2})+8f(x_{i+1})-8f(x_{i-1})+f(x_{i-2})}{12h}$$
    <br>
    <br>
3.  Find the [Second Derivative](http://en.wikipedia.org/wiki/Finite_difference#Relation_with_derivatives) (numerical using centered finite-divided-difference formulas)
    <br>
            $$f^{''}(x_i)=\frac{-f(x_{i+2})+16f(x_{i+1})-30f(x_i)+16(x_{i-1})-f(x_{i-2})}{12h^2}$$
    
<br>
<table>
<tr>
  <td align="center">The results shown below are for smoothing applied <b>10 times</b>:</td>
  <td align="center">The results shown below are for smoothing applied <b>500 times</b>:</td>
</tr>
  <tr>
    <td><iframe src="//www.slideshare.net/slideshow/embed_code/39731450" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></td>
    <td><iframe src="//www.slideshare.net/slideshow/embed_code/39731465" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></td>
  </tr>
</table>

<br>

## What Information was Garnered?

Application of the simple smoothing algorithm 10 times did a sufficient job of smoothing the function.  However, the first and 
second derivative algorithms are much more sensitive and need higher applications of smoothing as can be seen in the level of
residual noise in the second first and second derivative plots.  From the smoothed data plot at 0% completion (time = 0s), 
there are two distinct slope regions around the transition region.  The first is of constant slope that appears to indicate the 
boundary between tungsten the potassium hydroxide (KOH) solution.  The second appears due to an unexplained image artifact that 
appears to evolve throughout the series of images; attempts are made to disregard this feature.  The first derivative of this data
clearly indicates one prominent peak around the transition region. It was also found that at this point in time, the second 
derivative of the data may not yield any important information and will not be discussed further.

The smoothed data plot at 50% completion (time = 78s) starts to show signs of deviation from linearity in the slope region.  Another, 
smaller, slope deviation, is also highlighted from the earlier mentioned unexplained image artifact.  Interestingly, the first
derivative of this data shows signs of peak splitting which appears to fit nicely with a possible developing two boundary region.
Similar trends appear for the smoothed data plot at 100% completion (time = 155 seconds) which shows three prominent slopes and the 
first derivative of this data showing three peaks which fit nicely with a possible three boundary region.

Application of the simple smoothing algorithm 500 times did a very nice job of smoothing the data, but eliminates all of the interesting features of the plots.  Over-smoothing 
tends to eliminate adjacent (split) peaks and tends to move slopes from the raw data towards the same value.       

## Further Refinement of Image Processing

A second [Matlab code](https://github.com/jallen30gt/MIC-Tungsten-Nanowires/blob/gh-pages/StartProj.m) was created in an attempt
to identify the possible interfaces in the data images. This program advances some of the mathematical techniques used from the 
previous code and was written in collaboration with Tony Fast. This code was written to advance the image analysis and the 
important features are:


1.  [Matlab's 2-D median filtering](http://www.mathworks.com/help/images/ref/medfilt2.html) applied to smooth data
2.  [Derivative7](http://www.csse.uwa.edu.au/~pk/Research/MatlabFns/Spatial/derivative7.m) function was used to find the first derivatives
3.  [Matlab's imdilate function](http://www.mathworks.com/help/images/ref/imdilate.html) was used to [dialte](http://en.wikipedia.org/wiki/Dilation_(morphology))(i.e., find local maximum values) images
4.  Peaks were identified through dilation of the images and the peaks mapped to and identified on the original images 

<br>

The outputs of this algorithm can be seen below for data at 0% (time = 1s), approximately 50% (times = 76-82s) and 100% completion
(time - 155s).  Shown are the peaks of the first derivatives of the data taken acorss the width of each image for each
individual row of the images (not averaged down each row such as was conducted in earlier analysis).  Each first derivative 
peak (in a given row) is then mapped onto the image at the column position at which the peak was located.  As a point of 
clarification, images are rotated 90 degrees counterclockwise from their initial orientation (as shown earlier) 
and are cropped around the boundary region in an attempt to reduce the high noise levels (discussed earlier) at the edges 
of the edges of the images. Thus, when the term row or column is used here, it is meant in relation to the original orienations
shown earlier:
<br>
<br>

<iframe src="//www.slideshare.net/slideshow/embed_code/39630963" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<br>

Early in the time evolution (time = 0s), it can be seen that there is a large spread of data points on one side of the image.
This is attributed to the way in which the image was cropped for analysis.  As can be seen, the area with the large spread of 
data is mostly tungsten (dark) with very little Pottasium Hydroxide (KOH, light region).  This essentially distributes the first 
derivative data across the image in a way that there is a higher probability of finding a peak in a dark region than anywhere 
else.  The fact that the peaks agglomerate around the transition region in the areas of the image that are more balanced
with light and dark regions leads creedence to this line of thinking.

Very interesting are the distributions of data points around the transition regions for approximately 50% and 100% reaction 
completion (times = 76 - 82s and time = 155s resepectively).  As can be seen in the images, the points appear to clearly 
aggregate around the transition region and, further, split into three distinctive regions around a large tungsten-trioxide-hydrate 
growth region.


# Time Evolution of Raw Data 

Second step of image processing is the evolve of layer overtime, we plot different region of the image against time 
and hopefully it can give us more information about the layer evolve and, like when it is actually occur and how it is 
evolved. The first thing we do is plug the average pixel value (from rows 500 to 600) of each column overtime, we have 
1024 columns so we got 1024 graphs, each graph has average pixel value as y and the time as x. We can see at the 
beginning of the graph there is no trend, which is as expected because the layer most likely to found in the middle 
region of the image. As we keep moving right to the image, we can see clearly a shape represent the image evolve. 
It actually looks exactly like exponential function, and then change to a logistic function. I cannot figure 
out a precise function yet to describe this process overtime, but I believe that will be a valid next step.
<br>
<br>

Evolution of <b>columns 1-10</b> with time are shown below:

<iframe src="//www.slideshare.net/slideshow/embed_code/40270157" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<br>


Evolution of <b>columns 448-468</b> with time are shown below:

<iframe src="//www.slideshare.net/slideshow/embed_code/40270198" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<br>


Evolution of <b>columns 555-580</b> with time are shown below:

<iframe src="//www.slideshare.net/slideshow/embed_code/40270227" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<br>
<br>
<br>


# Time Derivative of Raw Data 

We also take the derivative of the data with time, but the resulting plot does not have obviously imformation as it is 
extremely noisy. We have to figure out a better filter and smoothing function to make that part useful, cause it can be 
useful as anvalid evidence for use to figure out the layer evolve function.

<br>


# Peak Position Time Evolution

Another interesting found is by ploting the location of peak (the place where change is the most dramatic). Over time, 
we can see the location have a almost linear down trend, but he maximum value(the change that happen between different 
column) has a linear trend of increase, we will discuss more about it and figure out what does that mean to us .

![Alt text](http://i.imgur.com/2s5N7Cf.png "Peak Position as a Function of Time")

![Alt text](http://i.imgur.com/7SwXpgx.png "Peak Amplitude as a Function of Time")


# Geometry of Derivatives?

By taking the derivative of the pictures, we can see at the beginning, the peak of the graph must represent layers, the 
peak region is almost like a rectangular. Then as time goes on, the peak region become more like a triangle, is that 
because there will only be one layer at the end? 


<iframe src="//www.slideshare.net/slideshow/embed_code/40276563" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>


<br>


<iframe src="//www.slideshare.net/slideshow/embed_code/40276585" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<br><br>



# Initial Attempts at Data Segmentation

For this trail run at segmentation, I used the matlab code developed by [Dr. Tom O'Haver ](http://terpconnect.umd.edu/~toh/) for 
peak fitting and the [naive segmentation](https://gist.github.com/tonyfast/de3d7b841cea38dc40fa) code written by Tony. I also 
used different matlab filters and smoothing functions to smooth the data (imfilter in tandom with fspecial, imresize, wiener2).
I varied the number of peaks between 3 and 8 and varied the number of bins from 10 to 1000. This provided extremely tedious. 
For this post, I settled for an image capture with the following values:

__{{site.data['segmentation']}}__

<br>
This image shows my initial efforts with the image truncated to the area of interest:

![Segmentation Image](http://i.imgur.com/MH8CuxO.jpg "Segmentation image ran with 7 peaks and 250 bins")

<br>


The image has been cropped to focus on a region of interest; that which we suspect is the evolvoing tri-oxide hydrate layer. 
For comparison sake, here is the orinal image deliniating the area of interest.

<br>

![Alt text](http://i.imgur.com/dExZKTw.jpg "Original image showing area of interest")


<br><br>

As you can see, the peak finding and fitting have some not so nice errors associated with conditions input.

<br>

![Alt text](http://i.imgur.com/RN7GadD.jpg "Segmentation histogram plot ran with 7 peaks and 250 bins")


<br>

## How does this relate to what has been done?

So, in reference to the segmented image, this image below represents the origianl image overlayed with the first spatial
derivative [work we did a couple of weeks prior.](http://jallen30gt.github.io/MIC-Tungsten-Nanowires/2014/09/26/Interface-Analysis.html)

<br>


![Alt text](http://i.imgur.com/Uk25D1G.jpg "Original image overlayed with first spatial derivative data")


<br>

I believe it is interesting to note that there whether we are taking numerical derivatives over the data or segmenting the data,
we find a simialar trend in this tri-oxide hydrate layer. 
